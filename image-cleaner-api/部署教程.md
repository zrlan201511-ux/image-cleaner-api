# 🚀 超详细部署教程（小白版）

## 📋 前提条件

**只需要这些**：
- ✅ 一个GitHub账号（免费）
- ✅ 能上网的电脑
- ✅ 10分钟时间

**不需要**：
- ❌ 不需要懂编程
- ❌ 不需要信用卡
- ❌ 不需要服务器
- ❌ 不需要域名

---

## 方式1: GitHub导入（最简单，强烈推荐）⭐⭐⭐

### 步骤1: 上传代码到GitHub

1. **访问GitHub**
   - 打开 https://github.com
   - 登录你的账号（没有就注册一个）

2. **创建新仓库**
   - 点击右上角 "+" → "New repository"
   - 仓库名填：`image-cleaner-api`
   - 选择 "Public"（公开）
   - 点击 "Create repository"

3. **上传文件**
   - 在新建的仓库页面，点击 "uploading an existing file"
   - 把这4个文件拖进去：
     - package.json
     - vercel.json
     - README.md
     - api文件夹（整个文件夹）
   - 点击 "Commit changes"

### 步骤2: 在Vercel部署

1. **访问Vercel**
   - 打开 https://vercel.com
   - 点击 "Start Deploying"
   - 选择 "Continue with GitHub"（用GitHub登录）
   - 授权Vercel访问你的GitHub

2. **导入项目**
   - 登录后点击 "Add New..." → "Project"
   - 找到刚才创建的 `image-cleaner-api` 仓库
   - 点击 "Import"

3. **部署**
   - 什么都不用改
   - 直接点击 "Deploy"
   - 等待1-2分钟（会看到进度条）

4. **完成！**
   - 部署成功后会显示：🎉 Congratulations!
   - 复制你的网址，例如：
     ```
     https://image-cleaner-api.vercel.app
     ```

### 步骤3: 测试

1. 访问你的网址（例如 https://image-cleaner-api.vercel.app）
2. 会看到一个漂亮的页面
3. 点击 "🧪 测试API" 按钮
4. 如果看到绿色的成功提示 ✓ 就说明部署成功了！

---

## 方式2: 命令行部署（需要一点技术）⭐⭐

### 步骤1: 安装Node.js

1. **下载Node.js**
   - 访问 https://nodejs.org
   - 下载左边的 "LTS" 版本
   - 双击安装，一路 "下一步"

2. **验证安装**
   - 打开命令行（Windows按 Win+R，输入 `cmd`）
   - 输入：`node -v`
   - 如果显示版本号（如 v18.17.0）就成功了

### 步骤2: 安装Vercel CLI

在命令行输入：
```bash
npm install -g vercel
```

等待安装完成（可能需要几分钟）

### 步骤3: 部署

1. **进入项目文件夹**
   ```bash
   cd D:\素材库\视频工作流\image-cleaner-api
   ```

2. **登录Vercel**
   ```bash
   vercel login
   ```
   - 会打开浏览器，用GitHub登录
   - 授权后回到命令行

3. **部署**
   ```bash
   vercel --prod
   ```
   - 第一次会问几个问题：
     - Set up and deploy? → 回车（是）
     - Which scope? → 回车（默认）
     - Link to existing project? → 输入 N（否）
     - What's your project's name? → 回车（默认）
     - In which directory is your code? → 回车（默认）
   - 等待部署（1-2分钟）

4. **完成！**
   - 会显示你的网址：
   ```
   ✅ Production: https://image-cleaner-api.vercel.app
   ```

---

## 🔧 在Coze中配置

### 1. 在Coze工作流中添加HTTP节点

**节点配置**：
```
名称: 清理图片元数据
类型: HTTP请求
方法: POST
URL: https://你的网址.vercel.app/api/clean
```

**Headers**:
```json
{
  "Content-Type": "application/json"
}
```

**Body**:
```json
{
  "imageUrl": "{{上一个节点生成的图片URL}}"
}
```

### 2. 连接到Sora节点

在Sora节点中，图片URL使用：
```
{{清理图片元数据.response.image}}
```

### 3. 完整工作流示例

```
开始
  ↓
节点1: 接收用户输入（产品信息）
  ↓
节点2: 生成创意故事
  ↓
节点3: 生成分镜脚本
  ↓
节点4: 生成image_prompt和video_prompt
  ↓
节点5: 用image_prompt生成图片（Coze图片生成插件）
  ↓
【新增】节点6: 清理图片元数据
  - URL: https://你的网址.vercel.app/api/clean
  - Body: { "imageUrl": "{{节点5的输出}}" }
  ↓
节点7: 生成Sora视频
  - 图片: {{节点6.response.image}}
  - 提示词: {{节点4的video_prompt}}
  ↓
返回视频
```

---

## ❓ 常见问题

### Q1: 部署失败怎么办？

**检查**：
- package.json 文件是否完整
- api 文件夹是否包含 clean.js 和 index.js
- vercel.json 文件是否存在

**重新部署**：
```bash
vercel --prod --force
```

### Q2: API调用失败？

**测试API**：
```bash
curl -X POST https://你的网址.vercel.app/api/clean \
  -H "Content-Type: application/json" \
  -d '{"imageUrl":"https://picsum.photos/400/300"}'
```

如果返回成功，说明API正常

### Q3: Coze调用返回错误？

**检查**：
1. URL是否正确（不要有多余的斜杠）
2. Headers是否设置了 `Content-Type: application/json`
3. Body是否是JSON格式
4. imageUrl是否是有效的图片链接

### Q4: 免费额度够用吗？

**Vercel免费版**：
- 每月100GB带宽
- 每月100GB-小时执行时间
- 无限制请求次数

**估算**：
- 每张图片处理约100KB响应
- 每月可处理约100万张图片
- 个人使用完全够！

---

## 🎉 成功标志

访问你的API首页，应该看到：
- ✓ 漂亮的紫色渐变背景
- ✓ API使用说明
- ✓ "测试API"按钮能正常工作
- ✓ 测试成功会显示绿色提示和图片

---

## 📞 需要帮助？

如果遇到问题：
1. 查看Vercel部署日志（在项目页面的 "Deployments" 标签）
2. 查看浏览器控制台错误（F12打开）
3. 重新部署试试

---

**恭喜！现在你有了自己的免费图片清理API！** 🎊

